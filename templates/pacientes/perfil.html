{% extends "admin_base.html" %}

{% block title %}Perfil de Paciente - {{ super() }}{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="admin-header">
    <div>
        <h1 class="admin-header-title">Perfil de Paciente</h1>
        <p class="admin-header-subtitle">Información detallada del paciente {{ paciente.usuario.nombre }}</p>
        <small class="admin-status">Código: {{ paciente.usuario.codigo_matricula }}</small>
    </div>
    <div class="admin-header-actions">
        {% if current_user.es_administrador() %}
        <a href="{{ url_for('pacientes.lista') }}" class="admin-btn admin-btn-secondary">
            <i class='bx bx-arrow-back'></i>
            Volver a Lista
        </a>
        {% endif %}
    </div>
</div>
<!-- Información del Paciente -->
<div style="display: grid; grid-template-columns: 350px 1fr; gap: 30px; margin-bottom: 30px;">
    <!-- Información Personal -->
    <div class="admin-chart-card">
        <div class="admin-chart-header">
            <h3 class="admin-chart-title">Información Personal</h3>
        </div>
        <div style="padding: 30px; text-align: center;">
            <div style="margin-bottom: 20px;">
                <i class='bx bx-user-circle' style="font-size: 80px; color: var(--admin-primary);"></i>
            </div>
            <h4 style="color: var(--admin-text-primary); margin-bottom: 8px;">{{ paciente.usuario.nombre }}</h4>
            <p style="color: var(--admin-text-secondary); margin-bottom: 20px;">{{ paciente.usuario.rol.value }}</p>
            
            <div style="border-top: 1px solid var(--admin-border); padding-top: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <strong style="color: var(--admin-text-primary);">Código:</strong>
                    <code style="background: var(--admin-secondary); padding: 4px 8px; border-radius: 4px;">
                        {{ paciente.usuario.codigo_matricula }}
                    </code>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <strong style="color: var(--admin-text-primary);">Edad:</strong>
                    <span class="admin-badge admin-badge-info">{{ paciente.edad() }} años</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <strong style="color: var(--admin-text-primary);">Carrera:</strong>
                    <span style="color: var(--admin-text-secondary);">{{ paciente.carrera }}</span>
                </div>
                
                <div style="display: flex; justify-content: space-between;">
                    <strong style="color: var(--admin-text-primary);">Teléfono:</strong>
                    <span style="color: var(--admin-text-secondary);">{{ paciente.telefono or 'No registrado' }}</span>
                </div>
            </div>
        </div>
    </div>
    <!-- Información Detallada -->
    <div>
        <!-- Información Adicional -->
        <div class="admin-chart-card" style="margin-bottom: 20px;">
            <div class="admin-chart-header">
                <h3 class="admin-chart-title">Información Adicional</h3>
            </div>
            <div style="padding: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h6 style="color: var(--admin-text-primary); margin-bottom: 8px;"><i class='bx bx-calendar'></i> Fecha de Nacimiento</h6>
                        <p style="color: var(--admin-text-secondary); margin: 0;">{{ paciente.fecha_nacimiento.strftime('%d/%m/%Y') }}</p>
                    </div>
                    <div>
                        <h6 style="color: var(--admin-text-primary); margin-bottom: 8px;"><i class='bx bx-map'></i> Dirección</h6>
                        <p style="color: var(--admin-text-secondary); margin: 0;">{{ paciente.direccion or 'No registrada' }}</p>
                    </div>
                </div>
                
                <div style="border-top: 1px solid var(--admin-border); padding-top: 20px;">
                    <h6 style="color: var(--admin-text-primary); margin-bottom: 15px;"><i class='bx bx-phone'></i> Contacto de Emergencia</h6>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <strong style="color: var(--admin-text-primary);">Nombre:</strong>
                            <p style="color: var(--admin-text-secondary); margin: 0;">{{ paciente.contacto_emergencia or 'No registrado' }}</p>
                        </div>
                        <div>
                            <strong style="color: var(--admin-text-primary);">Teléfono:</strong>
                            <p style="color: var(--admin-text-secondary); margin: 0;">{{ paciente.telefono_emergencia or 'No registrado' }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Historial Médico -->
        <div class="admin-chart-card" style="margin-bottom: 20px;">
            <div class="admin-chart-header">
                <h3 class="admin-chart-title">Historial Médico</h3>
            </div>
            <div style="padding: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background: var(--admin-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <i class='bx bx-calendar-check' style="font-size: 32px; color: var(--admin-primary); margin-bottom: 10px; display: block;"></i>
                        <h6 style="color: var(--admin-text-primary); margin-bottom: 5px;">Citas Totales</h6>
                        <h3 style="color: var(--admin-primary); margin: 0;">{{ paciente.citas|length }}</h3>
                    </div>
                    <div style="background: var(--admin-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <i class='bx bx-health' style="font-size: 32px; color: #28a745; margin-bottom: 10px; display: block;"></i>
                        <h6 style="color: var(--admin-text-primary); margin-bottom: 5px;">Consultas</h6>
                        <h3 style="color: #28a745; margin: 0;">{{ paciente.citas|selectattr('consulta')|list|length }}</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Acciones -->
        <div class="admin-chart-card">
            <div class="admin-chart-header">
                <h3 class="admin-chart-title">Acciones</h3>
            </div>
            <div style="padding: 25px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <a href="{{ url_for('citas.crear', paciente_id=paciente.id) }}" class="admin-btn admin-btn-primary">
                        <i class='bx bx-calendar-plus'></i> Nueva Cita
                    </a>
                    <a href="{{ url_for('citas.lista_paciente', paciente_id=paciente.id) }}" class="admin-btn admin-btn-info">
                        <i class='bx bx-calendar'></i> Ver Citas
                    </a>
                    <a href="{{ url_for('consultas.lista', paciente_id=paciente.id) }}" class="admin-btn admin-btn-success">
                        <i class='bx bx-health'></i> Consultas
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
